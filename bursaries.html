<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bursaries â€“ Career Unified</title>
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/bursaries.css">
</head>
<body>

<header>
  <h1>Available Bursaries</h1>
</header>

<nav>
  <a href="index.html">Home</a>
  <a href="jobs.html">Jobs</a>
  <a href="bursaries.html" class="active">Bursaries</a>
  <a href="varsity.html">Varsity</a>
  <a href="cv-generator.html">Generate CV</a>
</nav>

<main>
  <p>Filter bursaries by faculty or category and check deadlines.</p>
  <div class="filter">
    <label for="facultyFilter">Select Faculty/Category: </label>
    <select id="facultyFilter">
      <option value="All">All Bursaries</option>
    </select>
  </div>

  <ul id="bursaryList"></ul>
</main>

<footer>
  <p>Apply early and check bursary deadlines.</p>
</footer>

<script src="js/sanityClient.js"></script>
<script>
const bursaryList = document.getElementById('bursaryList');
const facultyFilter = document.getElementById('facultyFilter');
let bursaries = [];

async function fetchBursaries() {
  bursaries = await window.sanityClient.fetch(`*[_type=="bursary"] | order(deadline asc){
    _id,
    name,
    provider,
    faculty,
    description,
    deadline,
    link
  }`);

  const faculties = Array.from(new Set(bursaries.map(b=>b.faculty))).sort();
  faculties.forEach(f => {
    const opt = document.createElement('option');
    opt.value = f;
    opt.textContent = f;
    facultyFilter.appendChild(opt);
  });

  renderBursaries();
}

function renderBursaries(filter='All') {
  bursaryList.innerHTML = '';
  const filtered = filter==='All'?bursaries:bursaries.filter(b=>b.faculty===filter);
  if(!filtered.length){
    bursaryList.innerHTML = '<li>No bursaries found.</li>';
    return;
  }

  const today = new Date();
  filtered.forEach((b, index) => {
    const deadlineDate = new Date(b.deadline);
    const isUrgent = (deadlineDate - today)/(1000*60*60*24) <= 7;
    const shortDesc = b.description.length>150 ? b.description.substring(0,150)+'...' : b.description;
    const readMore = b.description.length>150 ? `<span class="read-more" onclick="toggleDesc(${index})">Read more</span>` : '';

    const li = document.createElement('li');
    li.className='bursary-card';
    li.innerHTML=`
      <strong>${b.name}</strong> (${b.faculty})<br>
      Provider: ${b.provider}<br>
      Deadline: ${b.deadline} ${isUrgent ? '<span class="urgent">Urgent</span>' : ''}<br>
      <p id="desc-${index}">${shortDesc}</p>
      ${readMore}<br>
      <a href="${b.link}" target="_blank">Apply Here</a>
    `;
    bursaryList.appendChild(li);
  });
}

function toggleDesc(index){
  const descEl=document.getElementById(`desc-${index}`);
  const b=bursaries[index];
  descEl.innerHTML = descEl.innerHTML.endsWith('...') ? b.description : b.description.substring(0,150)+'...';
}

facultyFilter.addEventListener('change', e=>renderBursaries(e.target.value));

fetchBursaries();
</script>
</body>
</html>




