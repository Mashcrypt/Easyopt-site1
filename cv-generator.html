<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CV Generator – Career Unified</title>

<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/cv-generator.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>

<body>

<header>
  <h1>CV Generator</h1>
</header>

<nav>
  <a href="index.html">Home</a>
  <a href="bursaries.html">Bursaries</a>
  <a href="jobs.html">Jobs</a>
  <a href="cv-generator.html" class="active">Generate CV</a>
</nav>

<main>
  <div class="form-card">
    <input id="fullName" placeholder="Full Name">
    <input id="email" placeholder="Email">
    <input id="phone" placeholder="Phone">

    <textarea id="summary" placeholder="Profile"></textarea>
    <textarea id="education" placeholder="Education"></textarea>
    <textarea id="experience" placeholder="Experience"></textarea>
    <textarea id="skills" placeholder="Skills"></textarea>

    <button onclick="generateCV()">Preview</button>
    <button onclick="downloadPDF()">Download PDF</button>
  </div>

  <div class="preview-card">
    <div id="cvPreview"><p>CV preview will appear here</p></div>
  </div>
</main>

<section style="max-width:1000px;margin:40px auto;">
  <h2>CV Tips</h2>
  <div id="cvTipsContainer"><p>Loading CV tips...</p></div>
</section>

<script type="module">
import { sanityClient } from './js/sanityClient.js';

// ----------------------------
// CV Preview & PDF Generation
// ----------------------------
const preview = document.getElementById('cvPreview');

function generateCV(){
  const fullName = document.getElementById('fullName').value;
  const email = document.getElementById('email').value;
  const phone = document.getElementById('phone').value;
  const summary = document.getElementById('summary').value;
  const education = document.getElementById('education').value;
  const experience = document.getElementById('experience').value;
  const skills = document.getElementById('skills').value;

  preview.innerHTML = `
    <h1>${fullName}</h1>
    <p>${email} | ${phone}</p>

    <h3>Profile</h3>
    <p style="white-space:pre-line;">${summary}</p>

    <h3>Education</h3>
    <p style="white-space:pre-line;">${education}</p>

    <h3>Experience</h3>
    <p style="white-space:pre-line;">${experience}</p>

    <h3>Skills</h3>
    <p style="white-space:pre-line;">${skills}</p>
  `;
}

function downloadPDF(){
  html2pdf().from(preview).save("My_CV.pdf");
}

// ----------------------------
// Load CV Tips from Sanity
// ----------------------------
const container = document.getElementById('cvTipsContainer');

async function fetchCVTips() {
  try {
    const tips = await sanityClient.fetch(`*[_type=="cvTip"] | order(title asc){_id,title,description,category}`);
    container.innerHTML = '';

    if(!tips.length){
      container.innerHTML = "<p>No CV tips available.</p>";
      return;
    }

    tips.forEach(tip => {
      const div = document.createElement('div');
      div.style.background = "#fff";
      div.style.padding = "15px";
      div.style.marginBottom = "10px";
      div.style.borderRadius = "8px";

      div.innerHTML = `
        <strong>${tip.title} (${tip.category})</strong>
        <p style="white-space:pre-line;">${tip.description}</p>
      `;
      container.appendChild(div);
    });
  } catch(err){
    container.innerHTML = "<p>Failed to load CV tips.</p>";
    console.error("Sanity fetch error:", err);
  }
}

// Initial fetch
fetchCVTips();
</script>

<footer>
  <p>© 2026 Career Unified</p>
</footer>

</body>
</html>




