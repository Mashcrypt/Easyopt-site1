<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Jobs | Career Unified</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="css/jobs.css" />

  <style>
    .job-badge {
      display: inline-block;
      padding: 4px 10px;
      font-size: 12px;
      border-radius: 12px;
      font-weight: 600;
      margin-top: 6px;
      background: linear-gradient(135deg, #ffb703, #fb8500);
      color: #000;
    }
    .job-card.selected {
      outline: 2px solid #ffb703;
    }
  </style>
</head>

<body>

<header>
  <h1>Available Jobs</h1>
</header>

<section class="filters">
  <input type="text" id="jobSearch" placeholder="Search jobs..." />

  <select id="categoryFilter">
    <option value="all">All Categories</option>
    <option value="internship">Internship / Graduate</option>
    <option value="temporary">Temporary Contract</option>
    <option value="freelance">Freelance</option>
  </select>
</section>

<main class="jobs-container">
  <ul id="jobList"></ul>

  <div id="jobPreview" class="job-preview">
    <p>Select a job to preview details</p>
  </div>
</main>

<script type="module">
  import { createClient } from "https://cdn.skypack.dev/@sanity/client";

  const sanityClient = createClient({
    projectId: "YOUR_PROJECT_ID",
    dataset: "production",
    apiVersion: "2024-01-01",
    useCdn: true
  });

  const jobList = document.getElementById("jobList");
  const jobPreview = document.getElementById("jobPreview");
  const jobSearch = document.getElementById("jobSearch");
  const categoryFilter = document.getElementById("categoryFilter");

  let jobs = [];
  let selectedIndex = -1;

  /* ===============================
     ðŸ”¥ SPONSORED / PREMIER FIX
  =============================== */

  function isActiveSponsored(job) {
    if (!job.sponsoredUntil) return true;
    return new Date(job.sponsoredUntil) >= new Date();
  }

  function getPriority(job) {
    if (job.isPremier && isActiveSponsored(job)) return 3;
    if (job.isSponsored && isActiveSponsored(job)) return 2;
    return 1;
  }

  function getBadge(job) {
    if (job.isPremier && isActiveSponsored(job)) return "Premier";
    if (job.isSponsored && isActiveSponsored(job)) return "Sponsored";
    return "";
  }

  /* ===============================
     FETCH JOBS FROM SANITY
  =============================== */

  async function fetchJobs() {
    jobs = await sanityClient.fetch(`
      *[_type == "job"] | order(posted desc){
        title,
        company,
        description,
        location,
        salary,
        applyLink,
        category,
        jobType,
        posted,
        deadline,
        isSponsored,
        isPremier,
        sponsoredUntil
      }
    `);

    renderJobs();
  }

  /* ===============================
     RENDER JOB LIST
  =============================== */

  function renderJobs() {
    const searchTerm = jobSearch.value.toLowerCase();
    const category = categoryFilter.value;

    const filtered = jobs.filter(job => {
      const matchCategory =
        category === "all" || job.category === category;

      const matchSearch =
        job.title?.toLowerCase().includes(searchTerm) ||
        job.company?.toLowerCase().includes(searchTerm) ||
        job.description?.toLowerCase().includes(searchTerm);

      return matchCategory && matchSearch;
    });

    /* ðŸ”¥ PRIORITY SORT */
    filtered.sort((a, b) => {
      const priorityDiff = getPriority(b) - getPriority(a);
      if (priorityDiff !== 0) return priorityDiff;

      return new Date(a.deadline) - new Date(b.deadline);
    });

    jobList.innerHTML = "";

    filtered.forEach((job, index) => {
      const badgeText = getBadge(job);

      const li = document.createElement("li");
      li.className = "job-card";
      if (index === selectedIndex) li.classList.add("selected");

      li.innerHTML = `
        <h3>${job.title}</h3>
        <p><strong>${job.company || "Confidential"}</strong></p>
        <p>${job.location}</p>
        <p>Salary: ${job.salary || "N/A"}</p>
        <p>Closing: ${job.deadline || "N/A"}</p>
        ${badgeText ? `<span class="job-badge">${badgeText}</span>` : ""}
      `;

      li.onclick = () => {
        selectedIndex = index;
        showPreview(job);
        renderJobs();
      };

      jobList.appendChild(li);
    });
  }

  /* ===============================
     JOB PREVIEW
  =============================== */

  function showPreview(job) {
    const badgeText = getBadge(job);

    jobPreview.innerHTML = `
      <h2>${job.title}</h2>
      ${badgeText ? `<span class="job-badge">${badgeText}</span>` : ""}
      <p><strong>Company:</strong> ${job.company || "Confidential"}</p>
      <p><strong>Location:</strong> ${job.location}</p>
      <p><strong>Job Type:</strong> ${job.jobType || "N/A"}</p>
      <p><strong>Salary:</strong> ${job.salary || "N/A"}</p>
      <p><strong>Description:</strong></p>
      <p>${job.description}</p>
      <a href="${job.applyLink}" target="_blank" class="apply-btn">
        Apply Now
      </a>
    `;
  }

  /* ===============================
     EVENTS
  =============================== */

  jobSearch.addEventListener("input", renderJobs);
  categoryFilter.addEventListener("change", renderJobs);

  fetchJobs();
</script>

</body>
</html>


































