<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Varsity â€“ Career Unified</title>
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/varsity.css">
</head>
<body>

<header>
  <h1>South African Universities</h1>
</header>

<nav>
  <a href="index.html">Home</a>
  <a href="jobs.html">Jobs</a>
  <a href="bursaries.html">Bursaries</a>
  <a href="varsity.html" class="active">Varsity</a>
  <a href="cv-generator.html">Generate CV</a>
</nav>

<main>
  <input type="text" id="searchInput" placeholder="Search universities..." />
  <button id="sortDeadlineBtn">Sort by Earliest Deadline</button>
  <ul id="varsityList"></ul>
</main>

<footer>
  <p>Apply early and check university application deadlines.</p>
</footer>

<script src="js/sanityClient.js"></script>
<script>
const varsityList = document.getElementById('varsityList');
const searchInput = document.getElementById('searchInput');
const sortBtn = document.getElementById('sortDeadlineBtn');
let universities = [];

async function fetchUniversities() {
  universities = await window.sanityClient.fetch(`*[_type=="university"] | order(deadline asc){
    name,
    link,
    deadline
  }`);
  renderList();
}

function renderList() {
  const query = searchInput.value.toLowerCase();
  varsityList.innerHTML = '';
  const filtered = universities.filter(u=>u.name.toLowerCase().includes(query));
  if(!filtered.length){
    varsityList.innerHTML = "<li>No universities match your search.</li>";
    return;
  }
  const today = new Date();
  filtered.forEach(uni=>{
    const deadlineDate = new Date(uni.deadline);
    const isOpen = deadlineDate >= today;
    const diffDays = Math.ceil((deadlineDate-today)/(1000*60*60*24));
    const isUrgent = diffDays <= 7 && isOpen;

    const li = document.createElement('li');
    li.className="varsity-card";
    li.innerHTML = `
      <a href="${uni.link}" target="_blank">${uni.name}</a>
      <small>Deadline: ${uni.deadline}</small>
      <span class="status ${isOpen?'open':'closed'}">${isOpen?'Open':'Closed'}</span>
      ${isUrgent ? '<span class="urgent">Urgent!</span>' : ''}
    `;
    varsityList.appendChild(li);
  });
}

searchInput.addEventListener('input', renderList);
sortBtn.addEventListener('click', ()=>{
  universities.sort((a,b)=> new Date(a.deadline)-new Date(b.deadline));
  renderList();
});

fetchUniversities();
</script>
</body>
</html>





